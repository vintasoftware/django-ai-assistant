
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Implement powerful AI assistants using Django">
      
      
      
        <link rel="canonical" href="https://vintasoftware.github.io/django-ai-assistant/0.1.1/reference/assistants-ref/">
      
      
        <link rel="prev" href="../use-cases-ref/">
      
      
        <link rel="next" href="../models-ref/">
      
      
      <link rel="icon" href="../../images/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>helpers.assistants - django-ai-assistant</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#django_ai_assistanthelpersassistants" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="django-ai-assistant" class="md-header__button md-logo" aria-label="django-ai-assistant" data-md-component="logo">
      
  <img src="../../images/logo-white-transparent-bg.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            django-ai-assistant
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              helpers.assistants
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/vintasoftware/django-ai-assistant/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vintasoftware/django-ai-assistant
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../get-started/" class="md-tabs__link">
        
  
    
  
  Get Started

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorial/" class="md-tabs__link">
        
  
    
  
  Tutorial

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../frontend/" class="md-tabs__link">
        
  
    
  
  Frontend

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
    
  
  Changelog

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../support/" class="md-tabs__link">
        
  
    
  
  Support

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="django-ai-assistant" class="md-nav__button md-logo" aria-label="django-ai-assistant" data-md-component="logo">
      
  <img src="../../images/logo-white-transparent-bg.svg" alt="logo">

    </a>
    django-ai-assistant
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vintasoftware/django-ai-assistant/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vintasoftware/django-ai-assistant
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frontend
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../use-cases-ref/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    helpers.use_cases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    helpers.assistants
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    helpers.assistants
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;assistants
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AIAssistant
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AIAssistant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.name" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.instructions" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.temperature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;temperature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.tool_max_concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;tool_max_concurrency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.has_rag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;has_rag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.structured_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;structured_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._method_tools" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_method_tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._registry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._user" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._request" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._view" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._init_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_init_kwargs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_cls_registry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cls_registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_cls" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.clear_cls_registry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_cls_registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_instructions" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_temperature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_temperature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_model_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_model_kwargs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_llm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_llm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_structured_output_llm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_structured_output_llm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_tools" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_document_separator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_document_separator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_document_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_document_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_retriever" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_retriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_contextualize_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_contextualize_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_history_aware_retriever" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_history_aware_retriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.as_graph" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;as_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.invoke" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;invoke
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.as_tool" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;as_tool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-ref/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Support
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;assistants
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;AIAssistant
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" AIAssistant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.id" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.name" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.instructions" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.temperature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;temperature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.tool_max_concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;tool_max_concurrency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.has_rag" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;has_rag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.structured_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;structured_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._method_tools" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_method_tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._registry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._user" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._request" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_request
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._view" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant._init_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;_init_kwargs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_cls_registry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cls_registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_cls" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.clear_cls_registry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_cls_registry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_instructions" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_temperature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_temperature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_model_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_model_kwargs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_llm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_llm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_structured_output_llm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_structured_output_llm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_tools" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_document_separator" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_document_separator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_document_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_document_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_retriever" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_retriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_contextualize_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_contextualize_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_history_aware_retriever" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_history_aware_retriever
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.as_graph" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;as_graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.invoke" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;invoke
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.run" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django_ai_assistant.helpers.assistants.AIAssistant.as_tool" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;as_tool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="django_ai_assistanthelpersassistants">django_ai_assistant.helpers.assistants<a class="headerlink" href="#django_ai_assistanthelpersassistants" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="django_ai_assistant.helpers.assistants"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="django_ai_assistant.helpers.assistants.AIAssistant" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>AIAssistant</code>


<a href="#django_ai_assistant.helpers.assistants.AIAssistant" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


      <p>Base class for AI Assistants. Subclasses must define at least the following attributes:</p>
<ul>
<li>id: str</li>
<li>name: str</li>
<li>instructions: str</li>
<li>model: str</li>
</ul>
<p>Subclasses can override the public methods to customize the behavior of the assistant.</p>
<p>Tools can be added to the assistant by decorating methods with <code>@method_tool</code>.</p>
<p>Check the docs Tutorial for more info on how to build an AI Assistant.</p>

              <details class="quote">
                <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AIAssistant</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>  <span class="c1"># noqa: F821</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for AI Assistants. Subclasses must define at least the following attributes:</span>

<span class="sd">    * id: str</span>
<span class="sd">    * name: str</span>
<span class="sd">    * instructions: str</span>
<span class="sd">    * model: str</span>

<span class="sd">    Subclasses can override the public methods to customize the behavior of the assistant.\n</span>
<span class="sd">    Tools can be added to the assistant by decorating methods with `@method_tool`.\n</span>
<span class="sd">    Check the docs Tutorial for more info on how to build an AI Assistant.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># noqa: A003</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class variable with the id of the assistant. Used to select the assistant to use.\n</span>
<span class="sd">    Must be unique across the whole Django project and match the pattern &#39;^[a-zA-Z0-9_-]+$&#39;.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class variable with the name of the assistant.</span>
<span class="sd">    Should be a friendly name to optionally display to users.&quot;&quot;&quot;</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Instructions for the AI assistant knowing what to do. This is the LLM system prompt.&quot;&quot;&quot;</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;LLM model name to use for the assistant.\n</span>
<span class="sd">    Should be a valid model name from OpenAI, because the default `get_llm` method uses OpenAI.\n</span>
<span class="sd">    `get_llm` can be overridden to use a different LLM implementation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Temperature to use for the assistant LLM model.\nDefaults to `1.0`.&quot;&quot;&quot;</span>
    <span class="n">tool_max_concurrency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum number of tools to run concurrently / in parallel.\nDefaults to `1` (no concurrency).&quot;&quot;&quot;</span>
    <span class="n">has_rag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether the assistant uses RAG (Retrieval-Augmented Generation) or not.\n</span>
<span class="sd">    Defaults to `False`.</span>
<span class="sd">    When True, the assistant will use a retriever to get documents to provide as context to the LLM.</span>
<span class="sd">    Additionally, the assistant class should implement the `get_retriever` method to return</span>
<span class="sd">    the retriever to use.&quot;&quot;&quot;</span>
    <span class="n">structured_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span> <span class="o">|</span> <span class="n">Type</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured output to use for the assistant.\n</span>
<span class="sd">    Defaults to `None`.</span>
<span class="sd">    When not `None`, the assistant will return a structured output in the provided format.</span>
<span class="sd">    See https://python.langchain.com/v0.3/docs/how_to/structured_output/ for the available formats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_user</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The current user the assistant is helping. A model instance.\n</span>
<span class="sd">    Set by the constructor.</span>
<span class="sd">    When API views are used, this is set to the current request user.\n</span>
<span class="sd">    Can be used in any `@method_tool` to customize behavior.&quot;&quot;&quot;</span>
    <span class="n">_request</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The current Django request the assistant was initialized with. A request instance.\n</span>
<span class="sd">    Set by the constructor.\n</span>
<span class="sd">    Can be used in any `@method_tool` to customize behavior.&quot;&quot;&quot;</span>
    <span class="n">_view</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The current Django view the assistant was initialized with. A view instance.\n</span>
<span class="sd">    Set by the constructor.\n</span>
<span class="sd">    Can be used in any `@method_tool` to customize behavior.&quot;&quot;&quot;</span>
    <span class="n">_init_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extra keyword arguments passed to the constructor.\n</span>
<span class="sd">    Set by the constructor.\n</span>
<span class="sd">    Can be used in any `@method_tool` to customize behavior.&quot;&quot;&quot;</span>
    <span class="n">_method_tools</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseTool</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of `@method_tool` tools the assistant can use. Automatically set by the constructor.&quot;&quot;&quot;</span>

    <span class="n">_registry</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;AIAssistant&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Registry of all AIAssistant subclasses by their id.\n</span>
<span class="sd">    Automatically populated by when a subclass is declared.\n</span>
<span class="sd">    Use `get_cls_registry` and `get_cls` to access the registry.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the AIAssistant instance.\n</span>
<span class="sd">        Optionally set the current user, request, and view for the assistant.\n</span>
<span class="sd">        Those can be used in any `@method_tool` to customize behavior.\n</span>

<span class="sd">        Args:</span>
<span class="sd">            user (Any | None): The current user the assistant is helping. A model instance.</span>
<span class="sd">                Defaults to `None`. Stored in `self._user`.</span>
<span class="sd">            request (Any | None): The current Django request the assistant was initialized with.</span>
<span class="sd">                A request instance. Defaults to `None`. Stored in `self._request`.</span>
<span class="sd">            view (Any | None): The current Django view the assistant was initialized with.</span>
<span class="sd">                A view instance. Defaults to `None`. Stored in `self._view`.</span>
<span class="sd">            **kwargs: Extra keyword arguments passed to the constructor. Stored in `self._init_kwargs`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_method_tools</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when a class is subclassed from AIAssistant.</span>

<span class="sd">        This method is automatically invoked when a new subclass of AIAssistant</span>
<span class="sd">        is created. It allows AIAssistant to perform additional setup or configuration</span>
<span class="sd">        for the subclass, such as registering the subclass in a registry.</span>

<span class="sd">        Args:</span>
<span class="sd">            cls (type): The newly created subclass.</span>
<span class="sd">            **kwargs: Additional keyword arguments passed during subclass creation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">AIAssistantMisconfiguredError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assistant id is not defined at </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AIAssistantMisconfiguredError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assistant id is None at </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[a-zA-Z0-9_-]+$&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="c1"># id should match the pattern &#39;^[a-zA-Z0-9_-]+$ to support as_tool in OpenAI</span>
            <span class="k">raise</span> <span class="n">AIAssistantMisconfiguredError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Assistant id &#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39; does not match the pattern &#39;^[a-zA-Z0-9_-]+$&#39;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;at </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">_set_method_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Find tool methods (decorated with `@method_tool` from django_ai_assistant/tools.py):</span>
        <span class="n">members</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">predicate</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;_is_tool&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">tool_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>

        <span class="c1"># Sort tool methods by the order they appear in the source code,</span>
        <span class="c1"># since this can be meaningful:</span>
        <span class="n">tool_methods</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Transform tool methods into tool objects:</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">tool_methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;_tool_maker_args&quot;</span><span class="p">):</span>
                <span class="n">tool</span> <span class="o">=</span> <span class="n">tool_decorator</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">method</span><span class="o">.</span><span class="n">_tool_maker_args</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">method</span><span class="o">.</span><span class="n">_tool_maker_kwargs</span><span class="p">,</span>
                <span class="p">)(</span><span class="n">method</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tool</span> <span class="o">=</span> <span class="n">tool_decorator</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">BaseTool</span><span class="p">,</span> <span class="n">tool</span><span class="p">))</span>

        <span class="c1"># Remove self from each tool args_schema:</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tool</span><span class="o">.</span><span class="n">args_schema</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">args_schema</span><span class="o">.</span><span class="n">__fields_set__</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                    <span class="n">tool</span><span class="o">.</span><span class="n">args_schema</span><span class="o">.</span><span class="n">__fields_set__</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
                <span class="n">tool</span><span class="o">.</span><span class="n">args_schema</span><span class="o">.</span><span class="n">__fields__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_method_tools</span> <span class="o">=</span> <span class="n">tools</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_cls_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;AIAssistant&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the registry of AIAssistant classes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, type[AIAssistant]]: A dictionary mapping assistant ids to their classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_cls</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">assistant_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;AIAssistant&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the AIAssistant class for the given assistant ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            assistant_id (str): The ID of the assistant to get.</span>
<span class="sd">        Returns:</span>
<span class="sd">            type[AIAssistant]: The AIAssistant subclass for the given ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_cls_registry</span><span class="p">()[</span><span class="n">assistant_id</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">clear_cls_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;AIAssistant&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the registry of AIAssistant classes.&quot;&quot;&quot;</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the instructions for the assistant. By default, this is the `instructions` attribute.\n</span>
<span class="sd">        Override the `instructions` attribute or this method to use different instructions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The instructions for the assistant, i.e., the LLM system prompt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the LLM model name for the assistant. By default, this is the `model` attribute.\n</span>
<span class="sd">        Used by the `get_llm` method to create the LLM instance.\n</span>
<span class="sd">        Override the `model` attribute or this method to use a different LLM model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The LLM model name for the assistant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

    <span class="k">def</span> <span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the temperature to use for the assistant LLM model.</span>
<span class="sd">        By default, this is the `temperature` attribute, which is `1.0` by default.\n</span>
<span class="sd">        Used by the `get_llm` method to create the LLM instance.\n</span>
<span class="sd">        Override the `temperature` attribute or this method to use a different temperature.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The temperature to use for the assistant LLM model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>

    <span class="k">def</span> <span class="nf">get_model_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get additional keyword arguments to pass to the LLM model constructor.\n</span>
<span class="sd">        Used by the `get_llm` method to create the LLM instance.\n</span>
<span class="sd">        Override this method to pass additional keyword arguments to the LLM model constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Additional keyword arguments to pass to the LLM model constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseChatModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the LangChain LLM instance for the assistant.</span>
<span class="sd">        By default, this uses the OpenAI implementation.\n</span>
<span class="sd">        `get_model`, `get_temperature`, and `get_model_kwargs` are used to create the LLM instance.\n</span>
<span class="sd">        Override this method to use a different LLM implementation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseChatModel: The LLM instance for the assistant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
        <span class="n">model_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_kwargs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_structured_output_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Runnable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the LLM model to use for the structured output.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseChatModel: The LLM model to use for the structured output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structured_output</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;structured_output is not defined&quot;</span><span class="p">)</span>

        <span class="n">llm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_llm</span><span class="p">()</span>

        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;json_mode&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">ChatOpenAI</span><span class="p">):</span>
            <span class="c1"># When using ChatOpenAI, it&#39;s better to use json_schema method</span>
            <span class="c1"># because it enables strict mode.</span>
            <span class="c1"># https://platform.openai.com/docs/guides/structured-outputs</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;json_schema&quot;</span>

        <span class="k">return</span> <span class="n">llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structured_output</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseTool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of method tools the assistant can use.</span>
<span class="sd">        By default, this is the `_method_tools` attribute, which are all `@method_tool`s.\n</span>
<span class="sd">        Override and call super to add additional tools,</span>
<span class="sd">        such as [any langchain_community tools](https://python.langchain.com/v0.3/docs/integrations/tools/).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sequence[BaseTool]: The list of tools the assistant can use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_tools</span>

    <span class="k">def</span> <span class="nf">get_document_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the RAG document separator to use in the prompt. Only used when `has_rag=True`.\n</span>
<span class="sd">        Defaults to `&quot;\\n\\n&quot;`, which is the LangChain default.\n</span>
<span class="sd">        Override this method to use a different separator.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: a separator for documents in the prompt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DEFAULT_DOCUMENT_SEPARATOR</span>

    <span class="k">def</span> <span class="nf">get_document_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the PromptTemplate template to use when rendering RAG documents in the prompt.</span>
<span class="sd">        Only used when `has_rag=True`.\n</span>
<span class="sd">        Defaults to `PromptTemplate.from_template(&quot;{page_content}&quot;)`, which is the LangChain default.\n</span>
<span class="sd">        Override this method to use a different template.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PromptTemplate: a prompt template for RAG documents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DEFAULT_DOCUMENT_PROMPT</span>

    <span class="k">def</span> <span class="nf">get_retriever</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseRetriever</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the RAG retriever to use for fetching documents.\n</span>
<span class="sd">        Must be implemented by subclasses when `has_rag=True`.\n</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseRetriever: the RAG retriever to use for fetching documents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Override the get_retriever with your implementation at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_contextualize_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the contextualize prompt template for the assistant.\n</span>
<span class="sd">        This is used when `has_rag=True` and there are previous messages in the thread.</span>
<span class="sd">        Since the latest user question might reference the chat history,</span>
<span class="sd">        the LLM needs to generate a new standalone question,</span>
<span class="sd">        and use that question to query the retriever for relevant documents.\n</span>
<span class="sd">        By default, this is a prompt that asks the LLM to</span>
<span class="sd">        reformulate the latest user question without the chat history.\n</span>
<span class="sd">        Override this method to use a different contextualize prompt.\n</span>
<span class="sd">        See `get_history_aware_retriever` for how this prompt is used.\n</span>

<span class="sd">        Returns:</span>
<span class="sd">            ChatPromptTemplate: The contextualize prompt template for the assistant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contextualize_q_system_prompt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Given a chat history and the latest user question &quot;</span>
            <span class="s2">&quot;which might reference context in the chat history, &quot;</span>
            <span class="s2">&quot;formulate a standalone question which can be understood &quot;</span>
            <span class="s2">&quot;without the chat history. Do NOT answer the question, &quot;</span>
            <span class="s2">&quot;just reformulate it if needed and otherwise return it as is.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="n">contextualize_q_system_prompt</span><span class="p">),</span>
                <span class="c1"># TODO: make history key configurable?</span>
                <span class="n">MessagesPlaceholder</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">),</span>
                <span class="c1"># TODO: make input key configurable?</span>
                <span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{input}</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_history_aware_retriever</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Runnable</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">RetrieverOutput</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the history-aware retriever LangChain chain for the assistant.\n</span>
<span class="sd">        This is used when `has_rag=True` to fetch documents based on the chat history.\n</span>
<span class="sd">        By default, this is a chain that checks if there is chat history,</span>
<span class="sd">        and if so, it uses the chat history to generate a new standalone question</span>
<span class="sd">        to query the retriever for relevant documents.\n</span>
<span class="sd">        When there is no chat history, it just passes the input to the retriever.\n</span>
<span class="sd">        Override this method to use a different history-aware retriever chain.</span>

<span class="sd">        Read more about the history-aware retriever in the</span>
<span class="sd">        [LangChain docs](https://python.langchain.com/v0.2/docs/how_to/qa_chat_history_how_to/).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Runnable[dict, RetrieverOutput]: a history-aware retriever LangChain chain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">llm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_llm</span><span class="p">()</span>
        <span class="n">retriever</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_retriever</span><span class="p">()</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contextualize_prompt</span><span class="p">()</span>

        <span class="c1"># Based on create_history_aware_retriever:</span>
        <span class="k">return</span> <span class="n">RunnableBranch</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># pyright: ignore[reportAttributeAccessIssue]</span>
                <span class="c1"># If no chat history, then we just pass input to retriever</span>
                <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">])</span> <span class="o">|</span> <span class="n">retriever</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># If chat history, then we pass inputs to LLM chain, then to retriever</span>
            <span class="n">prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span> <span class="o">|</span> <span class="n">retriever</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@with_cast_id</span>
    <span class="k">def</span> <span class="nf">as_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Runnable</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the LangGraph graph for the assistant.\n</span>
<span class="sd">        This graph is an agent that supports chat history, tool calling, and RAG (if `has_rag=True`).\n</span>
<span class="sd">        `as_graph` uses many other methods to create the graph for the assistant.</span>
<span class="sd">        Prefer to override the other methods to customize the graph for the assistant.</span>
<span class="sd">        Only override this method if you need to customize the graph at a lower level.</span>

<span class="sd">        Args:</span>
<span class="sd">            thread_id (Any | None): The thread ID for the chat message history.</span>
<span class="sd">                If `None`, an in-memory chat message history is used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the compiled graph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django_ai_assistant.models</span> <span class="kn">import</span> <span class="n">Thread</span>

        <span class="n">llm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_llm</span><span class="p">()</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tools</span><span class="p">()</span>
        <span class="n">llm_with_tools</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span> <span class="k">if</span> <span class="n">tools</span> <span class="k">else</span> <span class="n">llm</span>
        <span class="k">if</span> <span class="n">thread_id</span><span class="p">:</span>
            <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">thread_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thread</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">custom_add_messages</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">],</span> <span class="n">right</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">add_messages</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="n">thread</span><span class="p">:</span>
                <span class="c1"># Save all messages, except the initial system message:</span>
                <span class="n">thread_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">SystemMessage</span><span class="p">)]</span>
                <span class="n">save_django_messages</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">],</span> <span class="n">thread_messages</span><span class="p">),</span> <span class="n">thread</span><span class="o">=</span><span class="n">thread</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">class</span> <span class="nc">AgentState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
            <span class="n">messages</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AnyMessage</span><span class="p">],</span> <span class="n">custom_add_messages</span><span class="p">]</span>
            <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># noqa: A003</span>
            <span class="n">output</span><span class="p">:</span> <span class="n">Any</span>

        <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
            <span class="n">system_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instructions</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">SystemMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">system_prompt</span><span class="p">)]}</span>

        <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="n">thread</span><span class="o">.</span><span class="n">get_messages</span><span class="p">(</span><span class="n">include_extra_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">thread</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]))</span>

            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">messages</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">retriever</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_rag</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">retriever</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_history_aware_retriever</span><span class="p">()</span>
            <span class="c1"># Remove the initial instructions to prevent having two SystemMessages</span>
            <span class="c1"># This is necessary for compatibility with Anthropic</span>
            <span class="n">messages_to_summarize</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">input_message</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">docs</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">input_message</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="n">messages_to_summarize</span><span class="p">}</span>
            <span class="p">)</span>

            <span class="n">document_separator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_document_separator</span><span class="p">()</span>
            <span class="n">document_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_document_prompt</span><span class="p">()</span>

            <span class="n">formatted_docs</span> <span class="o">=</span> <span class="n">document_separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">format_document</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">document_prompt</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span>
            <span class="p">)</span>

            <span class="n">system_message</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">system_message</span><span class="o">.</span><span class="n">content</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---START OF CONTEXT---</span><span class="se">\n</span><span class="si">{</span><span class="n">formatted_docs</span><span class="si">}</span><span class="s2">---END OF CONTEXT---</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">agent</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">llm_with_tools</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">])</span>

            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>

        <span class="k">def</span> <span class="nf">tool_selector</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
            <span class="n">last_message</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_message</span><span class="p">,</span> <span class="n">AIMessage</span><span class="p">)</span> <span class="ow">and</span> <span class="n">last_message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;call_tool&quot;</span>

            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="k">def</span> <span class="nf">record_response</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
            <span class="c1"># Structured output must happen in the end, to avoid disabling tool calling.</span>
            <span class="c1"># Tool calling + structured output is not supported by OpenAI:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structured_output</span><span class="p">:</span>
                <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>

                <span class="c1"># Change the original system prompt:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">SystemMessage</span><span class="p">):</span>
                    <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Use the chat history to produce a JSON output.&quot;</span>

                <span class="c1"># Add a final message asking for JSON generation / structured output:</span>
                <span class="n">json_request_message</span> <span class="o">=</span> <span class="n">HumanMessage</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Use the chat history to produce a JSON output.&quot;</span>
                <span class="p">)</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json_request_message</span><span class="p">)</span>

                <span class="n">llm_with_structured_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_structured_output_llm</span><span class="p">()</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">llm_with_structured_output</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>

            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>

        <span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">AgentState</span><span class="p">)</span>

        <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">,</span> <span class="n">setup</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;retriever&quot;</span><span class="p">,</span> <span class="n">retriever</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;agent&quot;</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">tools</span><span class="p">))</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;respond&quot;</span><span class="p">,</span> <span class="n">record_response</span><span class="p">)</span>

        <span class="n">workflow</span><span class="o">.</span><span class="n">set_entry_point</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="s2">&quot;retriever&quot;</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;retriever&quot;</span><span class="p">,</span> <span class="s2">&quot;agent&quot;</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span>
            <span class="s2">&quot;agent&quot;</span><span class="p">,</span>
            <span class="n">tool_selector</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;call_tool&quot;</span><span class="p">:</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span>
                <span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="s2">&quot;respond&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="s2">&quot;agent&quot;</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;respond&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

    <span class="nd">@with_cast_id</span>
    <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Invoke the assistant LangChain graph with the given arguments and keyword arguments.\n</span>
<span class="sd">        This is the lower-level method to run the assistant.\n</span>
<span class="sd">        The graph is created by the `as_graph` method.\n</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Positional arguments to pass to the graph.</span>
<span class="sd">                To add a new message, use a dict like `{&quot;input&quot;: &quot;user message&quot;}`.</span>
<span class="sd">                If thread already has a `HumanMessage` in the end, you can invoke without args.</span>
<span class="sd">            thread_id (Any | None): The thread ID for the chat message history.</span>
<span class="sd">                If `None`, an in-memory chat message history is used.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the graph.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The output of the assistant graph,</span>
<span class="sd">                structured like `{&quot;output&quot;: &quot;assistant response&quot;, &quot;history&quot;: ...}`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_graph</span><span class="p">(</span><span class="n">thread_id</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_max_concurrency</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@with_cast_id</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the assistant with the given message and thread ID.\n</span>
<span class="sd">        This is the higher-level method to run the assistant.\n</span>

<span class="sd">        Args:</span>
<span class="sd">            message (str): The user message to pass to the assistant.</span>
<span class="sd">            thread_id (Any | None): The thread ID for the chat message history.</span>
<span class="sd">                If `None`, an in-memory chat message history is used.</span>
<span class="sd">            **kwargs: Additional keyword arguments to pass to the graph.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The assistant response to the user message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">thread_id</span><span class="o">=</span><span class="n">thread_id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_run_as_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">thread_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseTool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a tool from the assistant.\n</span>
<span class="sd">        This is useful to compose assistants.\n</span>

<span class="sd">        Args:</span>
<span class="sd">            description (str): The description for the tool.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseTool: A tool that runs the assistant. The tool name is this assistant&#39;s id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StructuredTool</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_as_tool</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="nb">id</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.id" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Class variable with the id of the assistant. Used to select the assistant to use.</p>
<p>Must be unique across the whole Django project and match the pattern '^[a-zA-Z0-9_-]+$'.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.name" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Class variable with the name of the assistant.
Should be a friendly name to optionally display to users.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.instructions" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.instructions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Instructions for the AI assistant knowing what to do. This is the LLM system prompt.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">model</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.model" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>LLM model name to use for the assistant.</p>
<p>Should be a valid model name from OpenAI, because the default <code>get_llm</code> method uses OpenAI.</p>
<p><code>get_llm</code> can be overridden to use a different LLM implementation.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.temperature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.temperature" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Temperature to use for the assistant LLM model.
Defaults to <code>1.0</code>.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.tool_max_concurrency" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">tool_max_concurrency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.tool_max_concurrency" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Maximum number of tools to run concurrently / in parallel.
Defaults to <code>1</code> (no concurrency).</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.has_rag" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">has_rag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.has_rag" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Whether the assistant uses RAG (Retrieval-Augmented Generation) or not.</p>
<p>Defaults to <code>False</code>.
When True, the assistant will use a retriever to get documents to provide as context to the LLM.
Additionally, the assistant class should implement the <code>get_retriever</code> method to return
the retriever to use.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.structured_output" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">structured_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span> <span class="o">|</span> <span class="n">Type</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.structured_output" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Structured output to use for the assistant.</p>
<p>Defaults to <code>None</code>.
When not <code>None</code>, the assistant will return a structured output in the provided format.
See https://python.langchain.com/v0.3/docs/how_to/structured_output/ for the available formats.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant._method_tools" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">_method_tools</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseTool</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant._method_tools" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>List of <code>@method_tool</code> tools the assistant can use. Automatically set by the constructor.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant._registry" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">_registry</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">AIAssistant</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant._registry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Registry of all AIAssistant subclasses by their id.</p>
<p>Automatically populated by when a subclass is declared.</p>
<p>Use <code>get_cls_registry</code> and <code>get_cls</code> to access the registry.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant._user" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">_user</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">user</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant._user" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>The current user the assistant is helping. A model instance.</p>
<p>Set by the constructor.
When API views are used, this is set to the current request user.</p>
<p>Can be used in any <code>@method_tool</code> to customize behavior.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant._request" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">_request</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">request</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant._request" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>The current Django request the assistant was initialized with. A request instance.</p>
<p>Set by the constructor.</p>
<p>Can be used in any <code>@method_tool</code> to customize behavior.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant._view" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">_view</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">view</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant._view" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>The current Django view the assistant was initialized with. A view instance.</p>
<p>Set by the constructor.</p>
<p>Can be used in any <code>@method_tool</code> to customize behavior.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="django_ai_assistant.helpers.assistants.AIAssistant._init_kwargs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">_init_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant._init_kwargs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Extra keyword arguments passed to the constructor.</p>
<p>Set by the constructor.</p>
<p>Can be used in any <code>@method_tool</code> to customize behavior.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Initialize the AIAssistant instance.</p>
<p>Optionally set the current user, request, and view for the assistant.</p>
<p>Those can be used in any <code>@method_tool</code> to customize behavior.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>user</code></td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current user the assistant is helping. A model instance.
Defaults to <code>None</code>. Stored in <code>self._user</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>request</code></td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current Django request the assistant was initialized with.
A request instance. Defaults to <code>None</code>. Stored in <code>self._request</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>view</code></td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current Django view the assistant was initialized with.
A view instance. Defaults to <code>None</code>. Stored in <code>self._view</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extra keyword arguments passed to the constructor. Stored in <code>self._init_kwargs</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the AIAssistant instance.\n</span>
<span class="sd">    Optionally set the current user, request, and view for the assistant.\n</span>
<span class="sd">    Those can be used in any `@method_tool` to customize behavior.\n</span>

<span class="sd">    Args:</span>
<span class="sd">        user (Any | None): The current user the assistant is helping. A model instance.</span>
<span class="sd">            Defaults to `None`. Stored in `self._user`.</span>
<span class="sd">        request (Any | None): The current Django request the assistant was initialized with.</span>
<span class="sd">            A request instance. Defaults to `None`. Stored in `self._request`.</span>
<span class="sd">        view (Any | None): The current Django view the assistant was initialized with.</span>
<span class="sd">            A view instance. Defaults to `None`. Stored in `self._view`.</span>
<span class="sd">        **kwargs: Extra keyword arguments passed to the constructor. Stored in `self._init_kwargs`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_request</span> <span class="o">=</span> <span class="n">request</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_view</span> <span class="o">=</span> <span class="n">view</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_set_method_tools</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_cls_registry" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_cls_registry</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_cls_registry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the registry of AIAssistant classes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, type[<a class="autorefs autorefs-internal" title="django_ai_assistant.helpers.assistants.AIAssistant" href="#django_ai_assistant.helpers.assistants.AIAssistant">AIAssistant</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, type[AIAssistant]]: A dictionary mapping assistant ids to their classes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_cls_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;AIAssistant&quot;</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the registry of AIAssistant classes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, type[AIAssistant]]: A dictionary mapping assistant ids to their classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_cls" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_cls</span><span class="p">(</span><span class="n">assistant_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_cls" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the AIAssistant class for the given assistant ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>assistant_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the assistant to get.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns:
    type[AIAssistant]: The AIAssistant subclass for the given ID.</p>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_cls</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">assistant_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;AIAssistant&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the AIAssistant class for the given assistant ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        assistant_id (str): The ID of the assistant to get.</span>
<span class="sd">    Returns:</span>
<span class="sd">        type[AIAssistant]: The AIAssistant subclass for the given ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_cls_registry</span><span class="p">()[</span><span class="n">assistant_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.clear_cls_registry" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">clear_cls_registry</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.clear_cls_registry" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Clear the registry of AIAssistant classes.</p>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">clear_cls_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;AIAssistant&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear the registry of AIAssistant classes.&quot;&quot;&quot;</span>

    <span class="bp">cls</span><span class="o">.</span><span class="n">_registry</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_instructions" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_instructions</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_instructions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the instructions for the assistant. By default, this is the <code>instructions</code> attribute.</p>
<p>Override the <code>instructions</code> attribute or this method to use different instructions.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The instructions for the assistant, i.e., the LLM system prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the instructions for the assistant. By default, this is the `instructions` attribute.\n</span>
<span class="sd">    Override the `instructions` attribute or this method to use different instructions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The instructions for the assistant, i.e., the LLM system prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_model</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_model" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the LLM model name for the assistant. By default, this is the <code>model</code> attribute.</p>
<p>Used by the <code>get_llm</code> method to create the LLM instance.</p>
<p>Override the <code>model</code> attribute or this method to use a different LLM model.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM model name for the assistant.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the LLM model name for the assistant. By default, this is the `model` attribute.\n</span>
<span class="sd">    Used by the `get_llm` method to create the LLM instance.\n</span>
<span class="sd">    Override the `model` attribute or this method to use a different LLM model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The LLM model name for the assistant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_temperature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_temperature</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_temperature" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the temperature to use for the assistant LLM model.
By default, this is the <code>temperature</code> attribute, which is <code>1.0</code> by default.</p>
<p>Used by the <code>get_llm</code> method to create the LLM instance.</p>
<p>Override the <code>temperature</code> attribute or this method to use a different temperature.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The temperature to use for the assistant LLM model.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the temperature to use for the assistant LLM model.</span>
<span class="sd">    By default, this is the `temperature` attribute, which is `1.0` by default.\n</span>
<span class="sd">    Used by the `get_llm` method to create the LLM instance.\n</span>
<span class="sd">    Override the `temperature` attribute or this method to use a different temperature.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The temperature to use for the assistant LLM model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_model_kwargs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_model_kwargs</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_model_kwargs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get additional keyword arguments to pass to the LLM model constructor.</p>
<p>Used by the <code>get_llm</code> method to create the LLM instance.</p>
<p>Override this method to pass additional keyword arguments to the LLM model constructor.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: Additional keyword arguments to pass to the LLM model constructor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_model_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get additional keyword arguments to pass to the LLM model constructor.\n</span>
<span class="sd">    Used by the `get_llm` method to create the LLM instance.\n</span>
<span class="sd">    Override this method to pass additional keyword arguments to the LLM model constructor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any]: Additional keyword arguments to pass to the LLM model constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_llm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_llm</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_llm" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the LangChain LLM instance for the assistant.
By default, this uses the OpenAI implementation.</p>
<p><code>get_model</code>, <code>get_temperature</code>, and <code>get_model_kwargs</code> are used to create the LLM instance.</p>
<p>Override this method to use a different LLM implementation.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BaseChatModel</code></td>            <td>
                  <code><span title="langchain_core.language_models.BaseChatModel">BaseChatModel</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM instance for the assistant.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseChatModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the LangChain LLM instance for the assistant.</span>
<span class="sd">    By default, this uses the OpenAI implementation.\n</span>
<span class="sd">    `get_model`, `get_temperature`, and `get_model_kwargs` are used to create the LLM instance.\n</span>
<span class="sd">    Override this method to use a different LLM implementation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseChatModel: The LLM instance for the assistant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_temperature</span><span class="p">()</span>
    <span class="n">model_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_kwargs</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_structured_output_llm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_structured_output_llm</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_structured_output_llm" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the LLM model to use for the structured output.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BaseChatModel</code></td>            <td>
                  <code><span title="langchain_core.runnables.Runnable">Runnable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The LLM model to use for the structured output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_structured_output_llm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Runnable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the LLM model to use for the structured output.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseChatModel: The LLM model to use for the structured output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structured_output</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;structured_output is not defined&quot;</span><span class="p">)</span>

    <span class="n">llm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_llm</span><span class="p">()</span>

    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;json_mode&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">ChatOpenAI</span><span class="p">):</span>
        <span class="c1"># When using ChatOpenAI, it&#39;s better to use json_schema method</span>
        <span class="c1"># because it enables strict mode.</span>
        <span class="c1"># https://platform.openai.com/docs/guides/structured-outputs</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;json_schema&quot;</span>

    <span class="k">return</span> <span class="n">llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structured_output</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_tools" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_tools</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_tools" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the list of method tools the assistant can use.
By default, this is the <code>_method_tools</code> attribute, which are all <code>@method_tool</code>s.</p>
<p>Override and call super to add additional tools,
such as <a href="https://python.langchain.com/v0.3/docs/integrations/tools/">any langchain_community tools</a>.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="langchain_core.tools.BaseTool">BaseTool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence[BaseTool]: The list of tools the assistant can use.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">BaseTool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the list of method tools the assistant can use.</span>
<span class="sd">    By default, this is the `_method_tools` attribute, which are all `@method_tool`s.\n</span>
<span class="sd">    Override and call super to add additional tools,</span>
<span class="sd">    such as [any langchain_community tools](https://python.langchain.com/v0.3/docs/integrations/tools/).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[BaseTool]: The list of tools the assistant can use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_tools</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_document_separator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_document_separator</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_document_separator" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the RAG document separator to use in the prompt. Only used when <code>has_rag=True</code>.</p>
<p>Defaults to <code>"\n\n"</code>, which is the LangChain default.</p>
<p>Override this method to use a different separator.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a separator for documents in the prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_document_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the RAG document separator to use in the prompt. Only used when `has_rag=True`.\n</span>
<span class="sd">    Defaults to `&quot;\\n\\n&quot;`, which is the LangChain default.\n</span>
<span class="sd">    Override this method to use a different separator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: a separator for documents in the prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DEFAULT_DOCUMENT_SEPARATOR</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_document_prompt" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_document_prompt</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_document_prompt" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the PromptTemplate template to use when rendering RAG documents in the prompt.
Only used when <code>has_rag=True</code>.</p>
<p>Defaults to <code>PromptTemplate.from_template("{page_content}")</code>, which is the LangChain default.</p>
<p>Override this method to use a different template.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PromptTemplate</code></td>            <td>
                  <code><span title="langchain_core.prompts.PromptTemplate">PromptTemplate</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a prompt template for RAG documents.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_document_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the PromptTemplate template to use when rendering RAG documents in the prompt.</span>
<span class="sd">    Only used when `has_rag=True`.\n</span>
<span class="sd">    Defaults to `PromptTemplate.from_template(&quot;{page_content}&quot;)`, which is the LangChain default.\n</span>
<span class="sd">    Override this method to use a different template.</span>

<span class="sd">    Returns:</span>
<span class="sd">        PromptTemplate: a prompt template for RAG documents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DEFAULT_DOCUMENT_PROMPT</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_retriever" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_retriever</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_retriever" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the RAG retriever to use for fetching documents.</p>
<p>Must be implemented by subclasses when <code>has_rag=True</code>.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BaseRetriever</code></td>            <td>
                  <code><span title="langchain_core.retrievers.BaseRetriever">BaseRetriever</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the RAG retriever to use for fetching documents.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_retriever</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseRetriever</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the RAG retriever to use for fetching documents.\n</span>
<span class="sd">    Must be implemented by subclasses when `has_rag=True`.\n</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseRetriever: the RAG retriever to use for fetching documents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Override the get_retriever with your implementation at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_contextualize_prompt" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_contextualize_prompt</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_contextualize_prompt" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the contextualize prompt template for the assistant.</p>
<p>This is used when <code>has_rag=True</code> and there are previous messages in the thread.
Since the latest user question might reference the chat history,
the LLM needs to generate a new standalone question,
and use that question to query the retriever for relevant documents.</p>
<p>By default, this is a prompt that asks the LLM to
reformulate the latest user question without the chat history.</p>
<p>Override this method to use a different contextualize prompt.</p>
<p>See <code>get_history_aware_retriever</code> for how this prompt is used.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ChatPromptTemplate</code></td>            <td>
                  <code><span title="langchain_core.prompts.ChatPromptTemplate">ChatPromptTemplate</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contextualize prompt template for the assistant.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_contextualize_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChatPromptTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the contextualize prompt template for the assistant.\n</span>
<span class="sd">    This is used when `has_rag=True` and there are previous messages in the thread.</span>
<span class="sd">    Since the latest user question might reference the chat history,</span>
<span class="sd">    the LLM needs to generate a new standalone question,</span>
<span class="sd">    and use that question to query the retriever for relevant documents.\n</span>
<span class="sd">    By default, this is a prompt that asks the LLM to</span>
<span class="sd">    reformulate the latest user question without the chat history.\n</span>
<span class="sd">    Override this method to use a different contextualize prompt.\n</span>
<span class="sd">    See `get_history_aware_retriever` for how this prompt is used.\n</span>

<span class="sd">    Returns:</span>
<span class="sd">        ChatPromptTemplate: The contextualize prompt template for the assistant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contextualize_q_system_prompt</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Given a chat history and the latest user question &quot;</span>
        <span class="s2">&quot;which might reference context in the chat history, &quot;</span>
        <span class="s2">&quot;formulate a standalone question which can be understood &quot;</span>
        <span class="s2">&quot;without the chat history. Do NOT answer the question, &quot;</span>
        <span class="s2">&quot;just reformulate it if needed and otherwise return it as is.&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="n">contextualize_q_system_prompt</span><span class="p">),</span>
            <span class="c1"># TODO: make history key configurable?</span>
            <span class="n">MessagesPlaceholder</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">),</span>
            <span class="c1"># TODO: make input key configurable?</span>
            <span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{input}</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.get_history_aware_retriever" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_history_aware_retriever</span><span class="p">()</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.get_history_aware_retriever" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the history-aware retriever LangChain chain for the assistant.</p>
<p>This is used when <code>has_rag=True</code> to fetch documents based on the chat history.</p>
<p>By default, this is a chain that checks if there is chat history,
and if so, it uses the chat history to generate a new standalone question
to query the retriever for relevant documents.</p>
<p>When there is no chat history, it just passes the input to the retriever.</p>
<p>Override this method to use a different history-aware retriever chain.</p>
<p>Read more about the history-aware retriever in the
<a href="https://python.langchain.com/v0.2/docs/how_to/qa_chat_history_how_to/">LangChain docs</a>.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="langchain_core.runnables.Runnable">Runnable</span>[dict, <span title="langchain_core.retrievers.RetrieverOutput">RetrieverOutput</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runnable[dict, RetrieverOutput]: a history-aware retriever LangChain chain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_history_aware_retriever</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Runnable</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">RetrieverOutput</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the history-aware retriever LangChain chain for the assistant.\n</span>
<span class="sd">    This is used when `has_rag=True` to fetch documents based on the chat history.\n</span>
<span class="sd">    By default, this is a chain that checks if there is chat history,</span>
<span class="sd">    and if so, it uses the chat history to generate a new standalone question</span>
<span class="sd">    to query the retriever for relevant documents.\n</span>
<span class="sd">    When there is no chat history, it just passes the input to the retriever.\n</span>
<span class="sd">    Override this method to use a different history-aware retriever chain.</span>

<span class="sd">    Read more about the history-aware retriever in the</span>
<span class="sd">    [LangChain docs](https://python.langchain.com/v0.2/docs/how_to/qa_chat_history_how_to/).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Runnable[dict, RetrieverOutput]: a history-aware retriever LangChain chain.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">llm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_llm</span><span class="p">()</span>
    <span class="n">retriever</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_retriever</span><span class="p">()</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contextualize_prompt</span><span class="p">()</span>

    <span class="c1"># Based on create_history_aware_retriever:</span>
    <span class="k">return</span> <span class="n">RunnableBranch</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># pyright: ignore[reportAttributeAccessIssue]</span>
            <span class="c1"># If no chat history, then we just pass input to retriever</span>
            <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">])</span> <span class="o">|</span> <span class="n">retriever</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="c1"># If chat history, then we pass inputs to LLM chain, then to retriever</span>
        <span class="n">prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span> <span class="o">|</span> <span class="n">retriever</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.as_graph" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">as_graph</span><span class="p">(</span><span class="n">thread_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.as_graph" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Create the LangGraph graph for the assistant.</p>
<p>This graph is an agent that supports chat history, tool calling, and RAG (if <code>has_rag=True</code>).</p>
<p><code>as_graph</code> uses many other methods to create the graph for the assistant.
Prefer to override the other methods to customize the graph for the assistant.
Only override this method if you need to customize the graph at a lower level.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>thread_id</code></td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The thread ID for the chat message history.
If <code>None</code>, an in-memory chat message history is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="langchain_core.runnables.Runnable">Runnable</span>[dict, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the compiled graph</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@with_cast_id</span>
<span class="k">def</span> <span class="nf">as_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Runnable</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the LangGraph graph for the assistant.\n</span>
<span class="sd">    This graph is an agent that supports chat history, tool calling, and RAG (if `has_rag=True`).\n</span>
<span class="sd">    `as_graph` uses many other methods to create the graph for the assistant.</span>
<span class="sd">    Prefer to override the other methods to customize the graph for the assistant.</span>
<span class="sd">    Only override this method if you need to customize the graph at a lower level.</span>

<span class="sd">    Args:</span>
<span class="sd">        thread_id (Any | None): The thread ID for the chat message history.</span>
<span class="sd">            If `None`, an in-memory chat message history is used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the compiled graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">django_ai_assistant.models</span> <span class="kn">import</span> <span class="n">Thread</span>

    <span class="n">llm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_llm</span><span class="p">()</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tools</span><span class="p">()</span>
    <span class="n">llm_with_tools</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">bind_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span> <span class="k">if</span> <span class="n">tools</span> <span class="k">else</span> <span class="n">llm</span>
    <span class="k">if</span> <span class="n">thread_id</span><span class="p">:</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">thread_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">custom_add_messages</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">],</span> <span class="n">right</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">]):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">add_messages</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">thread</span><span class="p">:</span>
            <span class="c1"># Save all messages, except the initial system message:</span>
            <span class="n">thread_messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">SystemMessage</span><span class="p">)]</span>
            <span class="n">save_django_messages</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">BaseMessage</span><span class="p">],</span> <span class="n">thread_messages</span><span class="p">),</span> <span class="n">thread</span><span class="o">=</span><span class="n">thread</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">class</span> <span class="nc">AgentState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
        <span class="n">messages</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AnyMessage</span><span class="p">],</span> <span class="n">custom_add_messages</span><span class="p">]</span>
        <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># noqa: A003</span>
        <span class="n">output</span><span class="p">:</span> <span class="n">Any</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
        <span class="n">system_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instructions</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">SystemMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">system_prompt</span><span class="p">)]}</span>

    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">thread</span><span class="o">.</span><span class="n">get_messages</span><span class="p">(</span><span class="n">include_extra_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">thread</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">messages</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">retriever</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_rag</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">retriever</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_history_aware_retriever</span><span class="p">()</span>
        <span class="c1"># Remove the initial instructions to prevent having two SystemMessages</span>
        <span class="c1"># This is necessary for compatibility with Anthropic</span>
        <span class="n">messages_to_summarize</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">input_message</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">input_message</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">:</span> <span class="n">messages_to_summarize</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="n">document_separator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_document_separator</span><span class="p">()</span>
        <span class="n">document_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_document_prompt</span><span class="p">()</span>

        <span class="n">formatted_docs</span> <span class="o">=</span> <span class="n">document_separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">format_document</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">document_prompt</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span>
        <span class="p">)</span>

        <span class="n">system_message</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">system_message</span><span class="o">.</span><span class="n">content</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">---START OF CONTEXT---</span><span class="se">\n</span><span class="si">{</span><span class="n">formatted_docs</span><span class="si">}</span><span class="s2">---END OF CONTEXT---</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">agent</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">llm_with_tools</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">response</span><span class="p">]}</span>

    <span class="k">def</span> <span class="nf">tool_selector</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
        <span class="n">last_message</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_message</span><span class="p">,</span> <span class="n">AIMessage</span><span class="p">)</span> <span class="ow">and</span> <span class="n">last_message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;call_tool&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

    <span class="k">def</span> <span class="nf">record_response</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">):</span>
        <span class="c1"># Structured output must happen in the end, to avoid disabling tool calling.</span>
        <span class="c1"># Tool calling + structured output is not supported by OpenAI:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structured_output</span><span class="p">:</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]</span>

            <span class="c1"># Change the original system prompt:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">SystemMessage</span><span class="p">):</span>
                <span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Use the chat history to produce a JSON output.&quot;</span>

            <span class="c1"># Add a final message asking for JSON generation / structured output:</span>
            <span class="n">json_request_message</span> <span class="o">=</span> <span class="n">HumanMessage</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Use the chat history to produce a JSON output.&quot;</span>
            <span class="p">)</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json_request_message</span><span class="p">)</span>

            <span class="n">llm_with_structured_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_structured_output_llm</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">llm_with_structured_output</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">AgentState</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">,</span> <span class="n">setup</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;retriever&quot;</span><span class="p">,</span> <span class="n">retriever</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;agent&quot;</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">tools</span><span class="p">))</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;respond&quot;</span><span class="p">,</span> <span class="n">record_response</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">set_entry_point</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;setup&quot;</span><span class="p">,</span> <span class="s2">&quot;history&quot;</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;history&quot;</span><span class="p">,</span> <span class="s2">&quot;retriever&quot;</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;retriever&quot;</span><span class="p">,</span> <span class="s2">&quot;agent&quot;</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span>
        <span class="s2">&quot;agent&quot;</span><span class="p">,</span>
        <span class="n">tool_selector</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;call_tool&quot;</span><span class="p">:</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span>
            <span class="s2">&quot;continue&quot;</span><span class="p">:</span> <span class="s2">&quot;respond&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="s2">&quot;agent&quot;</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;respond&quot;</span><span class="p">,</span> <span class="n">END</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">workflow</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.invoke" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">invoke</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.invoke" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Invoke the assistant LangChain graph with the given arguments and keyword arguments.</p>
<p>This is the lower-level method to run the assistant.</p>
<p>The graph is created by the <code>as_graph</code> method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>*args</code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments to pass to the graph.
To add a new message, use a dict like <code>{"input": "user message"}</code>.
If thread already has a <code>HumanMessage</code> in the end, you can invoke without args.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>thread_id</code></td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The thread ID for the chat message history.
If <code>None</code>, an in-memory chat message history is used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to the graph.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output of the assistant graph,
structured like <code>{"output": "assistant response", "history": ...}</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@with_cast_id</span>
<span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Invoke the assistant LangChain graph with the given arguments and keyword arguments.\n</span>
<span class="sd">    This is the lower-level method to run the assistant.\n</span>
<span class="sd">    The graph is created by the `as_graph` method.\n</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: Positional arguments to pass to the graph.</span>
<span class="sd">            To add a new message, use a dict like `{&quot;input&quot;: &quot;user message&quot;}`.</span>
<span class="sd">            If thread already has a `HumanMessage` in the end, you can invoke without args.</span>
<span class="sd">        thread_id (Any | None): The thread ID for the chat message history.</span>
<span class="sd">            If `None`, an in-memory chat message history is used.</span>
<span class="sd">        **kwargs: Keyword arguments to pass to the graph.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: The output of the assistant graph,</span>
<span class="sd">            structured like `{&quot;output&quot;: &quot;assistant response&quot;, &quot;history&quot;: ...}`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_graph</span><span class="p">(</span><span class="n">thread_id</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool_max_concurrency</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">thread_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.run" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Run the assistant with the given message and thread ID.</p>
<p>This is the higher-level method to run the assistant.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>message</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user message to pass to the assistant.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>thread_id</code></td>
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The thread ID for the chat message history.
If <code>None</code>, an in-memory chat message history is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**kwargs</code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments to pass to the graph.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assistant response to the user message.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@with_cast_id</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the assistant with the given message and thread ID.\n</span>
<span class="sd">    This is the higher-level method to run the assistant.\n</span>

<span class="sd">    Args:</span>
<span class="sd">        message (str): The user message to pass to the assistant.</span>
<span class="sd">        thread_id (Any | None): The thread ID for the chat message history.</span>
<span class="sd">            If `None`, an in-memory chat message history is used.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to the graph.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The assistant response to the user message.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">thread_id</span><span class="o">=</span><span class="n">thread_id</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="django_ai_assistant.helpers.assistants.AIAssistant.as_tool" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">as_tool</span><span class="p">(</span><span class="n">description</span><span class="p">)</span></code>

<a href="#django_ai_assistant.helpers.assistants.AIAssistant.as_tool" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Create a tool from the assistant.</p>
<p>This is useful to compose assistants.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>description</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The description for the tool.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BaseTool</code></td>            <td>
                  <code><span title="langchain_core.tools.BaseTool">BaseTool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tool that runs the assistant. The tool name is this assistant's id.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>django_ai_assistant/helpers/assistants.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">as_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseTool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a tool from the assistant.\n</span>
<span class="sd">    This is useful to compose assistants.\n</span>

<span class="sd">    Args:</span>
<span class="sd">        description (str): The description for the tool.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseTool: A tool that runs the assistant. The tool name is this assistant&#39;s id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">StructuredTool</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
        <span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_as_tool</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../use-cases-ref/" class="md-footer__link md-footer__link--prev" aria-label="Previous: helpers.use_cases">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                helpers.use_cases
              </div>
            </div>
          </a>
        
        
          
          <a href="../models-ref/" class="md-footer__link md-footer__link--next" aria-label="Next: models">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                models
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      From <a href="https://www.vintasoftware.com">Vinta Software</a> to the community with 💙
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/vintasoftware/django-ai-assistant/" target="_blank" rel="noopener" title="Django AI Assistant GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://x.com/vintasoftware" target="_blank" rel="noopener" title="Vinta Software X" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://linkedin.com/company/vintasoftware" target="_blank" rel="noopener" title="Vinta Software LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>